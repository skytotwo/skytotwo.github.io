<html>
      <head>
        <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1,user-scalable=no" />
        <meta charset="utf-8">
        <meta name="referrer" content="never">
        <title>附件上传至FTP和从FTP下载的代码 | Totoro の Home</title>
        <link rel="stylesheet" href="https://cdn.staticfile.org/KaTeX/0.11.1/katex.min.css">
        <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://skytotwo.github.io//styles/main.css">
          <script src="https://skytotwo.github.io//media/scripts/mdui.min.js"></script>
        <link rel="stylesheet" href="https://at.alicdn.com/t/font_1306644_jwtuc2zzbrd.css">
        <link href="https://fonts.googleapis.com/css?family=Dancing+Script|Ma+Shan+Zheng&display=swap" rel="stylesheet">
        <script src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>
        <script src="https://skytotwo.github.io//media/scripts/script.js"></script>
        <script >hljs.initHighlightingOnLoad();</script>
        

    </head>
    <body class="mdui-theme-primary-purple mdui-theme-accent-purple">
        <header class="index-img mdui-m-b-3"  style="background-image: url(http://picture.totoro.site/images/2019/08/05/440dc86152e38a28987392d773d50a7f.jpg);" >
                          <button class="mdui-btn  mdui-btn-icon mdui-btn-dense mdui-color-theme-500 mdui-ripple yinying mdui-m-t-1 mdui-m-l-1" mdui-menu="{target: '#demo-attr-cascade'}"><i class="mdui-icon material-icons">&#xe5d2;</i></button>
                <ul class="mdui-menu" id="demo-attr-cascade">
                
                        <li class="mdui-menu-item">
                          <a href="/" class="mdui-ripple">首页</a>
                        </li>
                
                        <li class="mdui-menu-item">
                          <a href="/archives" class="mdui-ripple">归档</a>
                        </li>
                
                        <li class="mdui-menu-item">
                          <a href="/tags" class="mdui-ripple">标签</a>
                        </li>
                
                        <li class="mdui-menu-item">
                          <a href="/post/about" class="mdui-ripple">关于</a>
                        </li>
                
                        <li class="mdui-menu-item">
                          <a href="http://picture.totoro.site/" class="mdui-ripple">图床</a>
                        </li>
                
                      </ul>

        </header>
        <div class="mdui-container post">
                <div class="mdui-row">
                        <div class="mdui-col-md-8 mdui-col-offset-md-2 ">
                         <article class="mdui-shadow-10 mdui-p-a-2 post-list">
                           <div class="mdui-typo-display-1 mdui-m-b-3">附件上传至FTP和从FTP下载的代码</div>
                           <a  class="index-list-biaoqian ">2019-08-05</a>
                           <div class="mdui-typo mdui-m-t-3 post-neirong"><p>之前用java做过福建上传ftp和从ftp下载文件的功能，这里做一下记录。</p>
<!-- more -->
<p>/<em><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>以下为附件上传至FTP和从FTP下载的代码</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></em>*****************************/</p>
<pre><code class="language-java">
/**  
* Description: 向SFTP服务器上传文件  
* @param host FTP服务器hostname  
* @param port FTP服务器端口  
* @param username FTP登录账号  
* @param password FTP登录密码  
* @param basePath FTP服务器基础目录 
* @param filePath FTP服务器文件存放路径。例如分日期存放：/2015/01/01。文件的路径为
* basePath+filePath 
* @param filename 上传到FTP服务器上的文件名  
* @param input 输入流  
* @return 成功返回true，否则返回false  
* @throws Exception 
* @author jolly	2017-12-1
*/    
public static boolean uploadFileToSFTP(String filename, HttpServletRequest request) throws Exception {  
	boolean result = false;  
	FTPClient ftp = new FTPClient();  
	Properties prop = new Properties();
	ResourceBundle resource = ResourceBundle
		.getBundle(&quot;tellhow/actions/ftp&quot;);// 读取ftp配置文件
	String host = resource.getString(&quot;HOST&quot;);
	int port = Integer.parseInt(resource.getString(&quot;PORT&quot;));
	String username = resource.getString(&quot;USERNAME&quot;);
	String password = resource.getString(&quot;PASSWORD&quot;);
	String filePath = resource.getString(&quot;FILEPATH&quot;);
	String localPath = request.getRealPath(&quot;/WebRoot/WEB-INF/upload/&quot;);
	try {  
		int reply;  
		ftp.connect(host, port);// 连接FTP服务器  
		// 如果采用默认端口，可以使用ftp.connect(host)的方式直接连接FTP服务器  
		boolean b = ftp.login(username, password);// 登录  
		if(!b){
			throw new Exception(&quot;登陆FTP不成功！&quot;);
		}
		reply = ftp.getReplyCode();  
		if (!FTPReply.isPositiveCompletion(reply)) {  
			ftp.disconnect();  
			return result;  
		}  
		File file = new File(localPath+filename);
		InputStream input = new FileInputStream(file);
		boolean t = ftp.changeWorkingDirectory(encoding(filePath));
		if(!t){
			ftp.mkd(encoding(filePath));
			ftp.changeWorkingDirectory(encoding(filePath));
		}
		//设置上传文件的类型为二进制类型  
		//ftp.setFileType(FTP.BINARY_FILE_TYPE);  
		boolean b2 = ftp.storeFile(encoding(filename), input);
		input.close();
		ftp.logout();
		if(!b2){
			throw new Exception(&quot;上传文件不成功！&quot;); 
		}
		result = true;  
	} catch (IOException e) {  
		e.printStackTrace();  
		throw new Exception(&quot;未能连接上Ftp服务器！&quot;);
	} finally {  
		if (ftp.isConnected()) {  
			try {  
				ftp.disconnect();  
			} catch (IOException ioe) {  
			}  
		} 
	}  
	return result;  
}  

/**  
* Description: 从FTP服务器下载文件  
* @param host FTP服务器hostname  
* @param port FTP服务器端口  
* @param username FTP登录账号  
* @param password FTP登录密码  
* @param remotePath FTP服务器上的相对路径  
* @param fileName 要下载的文件名  
* @param localPath 下载后保存到本地的路径  
* @return  
* @author jolly	2017-12-1
* @throws Exception 
*/    
public static boolean downloadFileFromFTP(String fileName, HttpServletRequest request) throws Exception {  
	boolean result = false;  
	FTPClient ftp = new FTPClient();  
	Properties prop = new Properties();
	ResourceBundle resource = ResourceBundle
		.getBundle(&quot;tellhow/actions/ftp&quot;);// 读取ftp配置文件
	String host = resource.getString(&quot;host&quot;);
	int port = Integer.parseInt(resource.getString(&quot;PORT&quot;));
	String username = resource.getString(&quot;USERNAME&quot;);
	String password = resource.getString(&quot;PASSWORD&quot;);
	String basePath = resource.getString(&quot;BASEPATH&quot;);
	String filePath = resource.getString(&quot;FILEPATH&quot;);
	String remotePath = resource.getString(&quot;REMOTEPATH&quot;);
	String localPath = request.getRealPath(&quot;/WebRoot/WEB-INF/upload&quot;);
	try {  
		int reply;  
		ftp.connect(host, port);  
		// 如果采用默认端口，可以使用ftp.connect(host)的方式直接连接FTP服务器  
		boolean b = ftp.login(username, password);// 登录  
		if(!b){
			throw new Exception(&quot;登陆FTP不成功！&quot;);
		}
		reply = ftp.getReplyCode();  
		if (!FTPReply.isPositiveCompletion(reply)) {  
			ftp.disconnect();  
			return result;  
		}  
		ftp.changeWorkingDirectory(remotePath);// 转移到FTP服务器目录  
		FTPFile[] fs = ftp.listFiles();  
		for (FTPFile ff : fs) {  
			if (ff.getName().equals(fileName)) {  
				File localFile = new File(localPath + &quot;/&quot; + ff.getName());  

				OutputStream is = new FileOutputStream(localFile);  
				ftp.retrieveFile(ff.getName(), is);  
				is.close();  
			}  
		}  

		ftp.logout();  
		result = true;  
	} catch (IOException e) {  
		e.printStackTrace();  
	} finally {  
		if (ftp.isConnected()) {  
			try {  
				ftp.disconnect();  
			} catch (IOException ioe) {  
			}  
		}  
	}  
	return result;  
} 


/**
* 编码转换
* @param obj
* @return
*/
private static String encoding(Object obj){
	try{
		if(obj==null)
			return &quot;&quot;;
		else
			return new String(obj.toString().getBytes(&quot;GBK&quot;),&quot;ISO-8859-1&quot;);
	}catch(Exception e){
		e.printStackTrace();
	}
	return &quot;&quot;; 
}

//删除文件，用于ftp上传完后删除本地临时文件夹文件
public void delFolder(String folderPath) {
	try {
		delAllFile(folderPath); // 删除完里面所有内容
	} catch (Exception e) {
		e.printStackTrace();
	}
}
// 删除指定文件夹下所有文件
// param path 文件夹完整绝对路径
public boolean delAllFile(String path) {
	boolean flag = false;
	File file = new File(path);
	if (!file.exists()) {
		return flag;
	}
	if (!file.isDirectory()) {
		return flag;
	}
	String[] tempList = file.list();
	File temp = null;
	for (int i = 0; i &lt; tempList.length; i++) {
		if (path.endsWith(File.separator)) {
			temp = new File(path + tempList[i]);
		} else {
			temp = new File(path + File.separator + tempList[i]);
		}
		if (temp.isFile()) {
			temp.delete();
		}
		if (temp.isDirectory()) {
			delAllFile(path + &quot;/&quot; + tempList[i]);// 先删除文件夹里面的文件
			flag = true;
		}
	}
	return flag;
}

public class SFTPConstants {
	public static final String SFTP_REQ_HOST = &quot;host&quot;;
	public static final String SFTP_REQ_PORT = &quot;port&quot;;
	public static final String SFTP_REQ_USERNAME = &quot;username&quot;;
	public static final String SFTP_REQ_PASSWORD = &quot;password&quot;;
	public static final int SFTP_DEFAULT_PORT = 22;
	public static final String SFTP_REQ_LOC = &quot;location&quot;;
}
</code></pre>
</div>
                              <div class="mdui-divider mdui-m-t-3"></div>
                              <div class="mdui-row-xs-2 mdui-m-t-2">
  <div class="mdui-col"> <div class="mdui-text-left"><a href="https://skytotwo.github.io//post/wechat-miniapp-learning-mark">微信小程序学习记要（上）</a></div></div>
 <div class="mdui-col"><div class="mdui-text-right "><a href="https://skytotwo.github.io//post/js-check-browser">js代码判断浏览器种类</a></div> </div>
                                </div>
                                <div class="mdui-divider mdui-m-t-2"></div>
   
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: 'c92214c141dbb1e37da6',
    clientSecret: '130f41f7ee3f5c06aa16d6392286c307d1e9b99c',
    repo: 'skytotwo.github.io',
    owner: 'skytotwo',
    admin: ['skytotwo'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        
 <script src="https://skytotwo.github.io//media/scripts/Valine.min.js"></script>
 <div class="comment"></div>

<script>
      new Valine({
            el: '.comment',



            path: window.location.pathname,
            pageSize: 30,
            avatar:'mm', 
       })

    </script> 
<script>
    if(window.location.hash){
        var checkExist = setInterval(function() {
           if ($(window.location.hash).length) {
              $('html, body').animate({scrollTop: $(window.location.hash).offset().top-90}, 1000);
              clearInterval(checkExist);
           }
        }, 100);
    }
</script>
                         </article>
                 <div class="toc-container mdui-float-right">
                
              </div>

                        </div>
                 </div>
          
        </div>
        <script data-no-instant>
    (function ($) {
        $.extend({
            adamsOverload: function () {
                $.viewImage({
                    'target'  : '.post-neirong img',
                    'exclude' : '.vsmile-icons img , .song-links-item img',
                    'delay'   : 300
                });
            }
        });
    })(jQuery);
    jQuery.adamsOverload();
</script>
        <footer class="footer mdui-m-t-5 mdui-text-center">
               <nav class="social-links">
                      <ul>
                      
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                      </ul>
                    </nav>
                  <div class="copyright">
                      <p>Powered by <a href="https://github.com/skytotwo" target="_blank">skytotwo</a></p>
                  </div>
              </footer>
    </body>
</html>